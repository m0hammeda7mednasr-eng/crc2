# ุฏููู ุงุณุชุฎุฏุงู Webhooks - ูู ูุณุชุฎุฏู ูู ุฑุงุจุท ุฎุงุต

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ูู ูุณุชุฎุฏู ูู ุงููุธุงู ูู webhook URLs ุฎุงุตุฉ ุจู ูุงุณุชูุจุงู ุงูุฑุณุงุฆู ูุงูุทูุจุงุช. ูุฐุง ูุถูู ุฃู ูู ูุณุชุฎุฏู ูุณุชูุจู ุจูุงูุงุชู ุงูุฎุงุตุฉ ููุท.

---

## ๐ฑ 1. Webhook ูุงุณุชูุจุงู ุฑุณุงุฆู WhatsApp

### ุงูุฑุงุจุท ุงูุฎุงุต ุจู:
```
https://crc2-production.up.railway.app/api/webhook/incoming/{userId}
```

### ููููุฉ ุงูุญุตูู ุนูู userId:
1. ุณุฌู ุฏุฎูู ุนูู ุงููููุน
2. ุงูุชุญ ุตูุญุฉ Settings
3. ุณุชุฌุฏ ุงูุฑุงุจุท ุงููุงูู ูุนุฑูุถ ูุน ุฒุฑ "Copy"

### ูุซุงู ุนูู ุงูุงุณุชุฎุฏุงู:

#### ูู n8n:
```json
POST https://crc2-production.up.railway.app/api/webhook/incoming/user-123
Content-Type: application/json

{
  "phoneNumber": "+201234567890",
  "content": "ูุฑุญุจุงู! ุฃุฑูุฏ ุงูุงุณุชูุณุงุฑ ุนู ููุชุฌ",
  "customerName": "ุฃุญูุฏ ูุญูุฏ",
  "type": "text"
}
```

#### ุตูุบุฉ ุจุฏููุฉ (n8n format):
```json
{
  "from": "+201234567890",
  "body": "ูุฑุญุจุงู! ุฃุฑูุฏ ุงูุงุณุชูุณุงุฑ ุนู ููุชุฌ",
  "name": "ุฃุญูุฏ ูุญูุฏ"
}
```

### ุงูุญููู ุงููุทููุจุฉ:
- `phoneNumber` ุฃู `from`: ุฑูู ูุงุชู ุงูุนููู (ูุทููุจ)
- `content` ุฃู `body`: ูุต ุงูุฑุณุงูุฉ (ูุทููุจ)
- `customerName` ุฃู `name`: ุงุณู ุงูุนููู (ุงุฎุชูุงุฑู)
- `type`: ููุน ุงูุฑุณุงูุฉ (text, image, etc.) - ุงูุชุฑุงุถู: text

---

## ๐ 2. Webhook ูุงุณุชูุจุงู ุทูุจุงุช Shopify

### ุทุฑููุชุงู ููุงุณุชุฎุฏุงู:

#### ุงูุทุฑููุฉ ุงูุฃููู: ุจุงุณุชุฎุฏุงู Shop Domain (ููุตู ุจูุง)
```
https://crc2-production.up.railway.app/api/webhook/shopify/orders?shop=my-store
```

**ุงููููุฒุงุช:**
- ุฃุณูู ูู ุงูุงุณุชุฎุฏุงู
- ูุง ุชุญุชุงุฌ ููุนุฑูุฉ userId
- ูุชู ุงูุชุนุฑู ุนูู ุงููุณุชุฎุฏู ุชููุงุฆูุงู ูู ุงุณู ุงููุชุฌุฑ

**ุงูุฎุทูุงุช:**
1. ูู ุตูุญุฉ Settingsุ ุฃุฏุฎู Shopify Domain ุงูุฎุงุต ุจู (ูุซู: `my-store.myshopify.com`)
2. ุงุญูุธ ุงูุฅุนุฏุงุฏุงุช
3. ุงูุณุฎ ุงูุฑุงุจุท ุงููุนุฑูุถ
4. ุงุณุชุฎุฏูู ูู Shopify Webhook Settings

#### ุงูุทุฑููุฉ ุงูุซุงููุฉ: ุจุงุณุชุฎุฏุงู userId (ูุฏููุฉ)
```
https://crc2-production.up.railway.app/api/webhook/shopify/orders?userId=user-123
```

### ุฅุนุฏุงุฏ Webhook ูู Shopify:

1. ุงูุชุญ Shopify Admin Panel
2. ุงุฐูุจ ุฅูู: Settings โ Notifications โ Webhooks
3. ุงุถุบุท "Create webhook"
4. ุงุฎุชุฑ Event: `Order creation`
5. ุงูุตู ุงูุฑุงุจุท ูู ุญูู URL
6. Format: JSON
7. ุงุญูุธ

### ูุซุงู ุนูู ุงูุจูุงูุงุช ุงููุฑุณูุฉ ูู Shopify:
```json
{
  "id": 12345,
  "order_number": 1001,
  "name": "#1001",
  "total_price": "150.00",
  "customer": {
    "first_name": "ุฃุญูุฏ",
    "last_name": "ูุญูุฏ",
    "phone": "+201234567890"
  },
  "line_items": [
    {
      "name": "ููุชุฌ ุชุฌุฑูุจู",
      "quantity": 2,
      "price": "75.00"
    }
  ],
  "shipping_address": {
    "phone": "+201234567890"
  }
}
```

---

## ๐งช 3. ุงุฎุชุจุงุฑ Webhooks

### ุงุฎุชุจุงุฑ ุฑุณุงุฆู WhatsApp:

ุงุณุชุฎุฏู Postman ุฃู cURL:

```bash
curl -X POST https://crc2-production.up.railway.app/api/webhook/incoming/YOUR_USER_ID \
  -H "Content-Type: application/json" \
  -d '{
    "phoneNumber": "+201234567890",
    "content": "ุฑุณุงูุฉ ุชุฌุฑูุจูุฉ",
    "customerName": "ุนููู ุชุฌุฑูุจู"
  }'
```

### ุงุฎุชุจุงุฑ ุทูุจุงุช Shopify:

```bash
curl -X POST "https://crc2-production.up.railway.app/api/webhook/shopify/orders?shop=my-store" \
  -H "Content-Type: application/json" \
  -d '{
    "id": 99999,
    "order_number": 9999,
    "total_price": "100.00",
    "customer": {
      "first_name": "ุชุฌุฑูุจู",
      "last_name": "ุนููู",
      "phone": "+201234567890"
    },
    "line_items": [
      {
        "name": "ููุชุฌ ุชุฌุฑูุจู",
        "quantity": 1,
        "price": "100.00"
      }
    ]
  }'
```

---

## ๐ 4. ุงูุฃูุงู

### Rate Limiting:
- ูู webhook ูุญูู ุจู rate limiter
- ุงูุญุฏ ุงูุฃูุตู: 100 ุทูุจ ูู 15 ุฏูููุฉ ููู IP

### ุงูุชุญูู ูู ุงูุจูุงูุงุช:
- ูุชู ุงูุชุญูู ูู ุฌููุน ุงูุญููู ุงููุทููุจุฉ
- ูุชู ุชูุธูู ุฃุฑูุงู ุงูููุงุชู ุชููุงุฆูุงู
- ูุชู ุฑูุถ ุงูุทูุจุงุช ุบูุฑ ุงูุตุญูุญุฉ ูุน ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ

---

## ๐ 5. ุงูุงุณุชุฌุงุจุงุช

### ูุฌุงุญ (200 OK):
```json
{
  "message": "Message received successfully",
  "data": {
    "id": "msg-123",
    "content": "ูุฑุญุจุงู",
    "createdAt": "2026-02-20T20:00:00.000Z"
  },
  "userId": "user-123"
}
```

### ุฎุทุฃ (400 Bad Request):
```json
{
  "error": "phoneNumber/from and content/body are required",
  "code": "VALIDATION_ERROR",
  "timestamp": "2026-02-20T20:00:00.000Z",
  "received": { ... }
}
```

### ุฎุทุฃ ูู ุงูุณูุฑูุฑ (500):
```json
{
  "error": "Failed to process incoming message",
  "code": "SERVER_ERROR",
  "timestamp": "2026-02-20T20:00:00.000Z",
  "details": "..."
}
```

---

## ๐ก ูุตุงุฆุญ

1. **ุงุญูุธ ุงูุฑูุงุจุท**: ุงูุณุฎ ุฑูุงุจุท ุงูู webhooks ูู ุตูุญุฉ Settings ูุงุญูุธูุง ูู ููุงู ุขูู

2. **ุงุฎุชุจุฑ ุฃููุงู**: ูุจู ุงูุงุณุชุฎุฏุงู ุงููุนููุ ุงุฎุชุจุฑ ุงูู webhooks ุจุงุณุชุฎุฏุงู Postman

3. **ุฑุงูุจ ุงูุฃุฎุทุงุก**: ุชุญูู ูู ููุฌุงุช ุงูุณูุฑูุฑ ุฅุฐุง ูู ุชุตู ุงูุฑุณุงุฆู

4. **ุงุณุชุฎุฏู HTTPS**: ุฌููุน ุงูุฑูุงุจุท ุชุณุชุฎุฏู HTTPS ููุฃูุงู

5. **Shop Domain**: ุงุณุชุฎุฏู Shop Domain ุจุฏูุงู ูู userId ูู Shopify webhooks (ุฃุณูู ูุฃูุถุญ)

---

## ๐ ุญู ุงููุดุงูู

### ุงููุดููุฉ: ุงูุฑุณุงุฆู ูุง ุชุตู

**ุงูุญููู:**
1. ุชุฃูุฏ ูู ุตุญุฉ ุงูุฑุงุจุท (userId ุตุญูุญ)
2. ุชุฃูุฏ ูู Content-Type: application/json
3. ุชุฃูุฏ ูู ุตุญุฉ ุงูุจูุงูุงุช ุงููุฑุณูุฉ
4. ุชุญูู ูู ููุฌุงุช ุงูุณูุฑูุฑ

### ุงููุดููุฉ: ุฎุทุฃ 400 - VALIDATION_ERROR

**ุงูุญููู:**
1. ุชุฃูุฏ ูู ูุฌูุฏ phoneNumber/from
2. ุชุฃูุฏ ูู ูุฌูุฏ content/body
3. ุชุญูู ูู ุตูุบุฉ JSON

### ุงููุดููุฉ: ุฎุทุฃ 404 - Not Found

**ุงูุญููู:**
1. ุชุฃูุฏ ูู ุตุญุฉ ุงูุฑุงุจุท
2. ุชุฃูุฏ ูู ูุฌูุฏ /api/webhook ูู ุงูุฑุงุจุท
3. ุชุฃูุฏ ูู userId ุตุญูุญ

---

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดููุฉ:
1. ุชุญูู ูู ูุฐุง ุงูุฏููู ุฃููุงู
2. ุงุฎุชุจุฑ ุงูู webhook ุจุงุณุชุฎุฏุงู Postman
3. ุชุญูู ูู ููุฌุงุช ุงูุณูุฑูุฑ ูู Railway
4. ุชูุงุตู ูุน ุงูุฏุนู ุงูููู
